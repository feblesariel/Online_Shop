<!DOCTYPE html>
<html lang="en">

<%-include("./partials/head.ejs")%>

  <body>

    <%-include("./partials/header.ejs")%>

      <!-- Breadcrumb Start -->
      <div class="container-fluid">
        <div class="row px-xl-5">
          <div class="col-12">
            <nav class="breadcrumb bg-light mb-30">
              <a class="breadcrumb-item text-dark text-decoration-none" href="/">Inicio</a>
              <span class="breadcrumb-item active">Ajustes</span>
            </nav>
          </div>
        </div>
      </div>
      <!-- Breadcrumb End -->

      <div class="container-fluid pb-5">
        <div class="row px-xl-5">
          <div class="col">
            <div class="bg-light p-30">
              <div class="nav nav-tabs mb-4">
                <a class="nav-item nav-link text-dark active" data-toggle="tab" href="#tab-pane-1">Productos</a>
                <a class="nav-item nav-link text-dark" data-toggle="tab" href="#tab-pane-2">Usuarios</a>
              </div>
              <div class="tab-content">

                <!-- Products -->

                <div class="tab-pane fade show active" id="tab-pane-1">

                  <div class="d-flex justify-content-between align-items-center">
                    <div class="pb-3">
                      <span class="text-uppercase font-weight-bold">productos cargados: <%=Products.length%></span>
                    </div>
                    <div class="pb-3">
                      <button type="button" class="btn btn-success" data-toggle="modal"
                        data-target="#productCreateModal"><span
                          class="text-uppercase font-weight-bold">nuevo</span></button>
                    </div>
                  </div>

                  <table class="table table-light table-hover text-center mb-0">
                    <thead class="thead-dark">
                      <tr>
                        <th class="d-none d-lg-block border-0">Nombre</th>
                        <th class="border-0">Codigo</th>
                        <th class="border-0">Precio</th>
                        <th class="d-none d-lg-block border-0">Stock</th>
                        <th class="border-0">Editar</th>
                        <th class="border-0">Eliminar</th>
                      </tr>
                    </thead>
                    <tbody>

                      <% if (Products) { Products.forEach (item=> { %>

                        <tr>
                          <td class="d-none d-lg-block">
                            <p class="fw-bold mb-1">
                              <%=item.name%>
                            </p>
                          </td>
                          <td>
                            <p class="fw-normal mb-1">
                              <%=item.code%>
                            </p>
                          </td>
                          <td>
                            <p class="fw-normal mb-1">
                              <%=item.price%>
                            </p>
                          </td>
                          <td class="d-none d-lg-block">
                            <p class="fw-normal mb-1">
                              <%=item.stock%>
                            </p>
                          </td>
                          <td>
                            <button type="submit" data-toggle="modal" data-target="" data-id=""
                              class="btn btn-sm btn-success"><i class="fa fa-pen fa-sm"></i></button>
                          </td>
                          <td>
                            <button type="submit" data-toggle="modal" data-target="" data-id=""
                              class="btn btn-sm btn-danger"><i class="fa fa-times"></i></button>
                          </td>
                        </tr>

                        <% })} %>

                    </tbody>
                  </table>
                </div>

                <!-- Users -->

                <div class="tab-pane fade" id="tab-pane-2">

                  <div class="pb-3">
                    <span class="text-uppercase font-weight-bold">Usuarios registrados: <%=Users.length%></span>
                  </div>

                  <table class="table table-light table-hover text-center mb-0">
                    <thead class="thead-dark">
                      <tr>
                        <th class="border-0">Nombre</th>
                        <th class="d-none d-lg-block border-0">Email</th>
                        <th class="border-0">Rol</th>
                        <th class="border-0">Eliminar</th>
                      </tr>
                    </thead>
                    <tbody>

                      <% if (Users) { Users.forEach (item=> { %>

                        <tr>
                          <td>
                            <p class="fw-bold mb-1">
                              <%=item.name%>
                            </p>
                          </td>
                          <td class="d-none d-lg-block">
                            <p class="fw-normal mb-1">
                              <%=item.email%>
                            </p>
                          </td>
                          <td>
                            <span class="badge badge-success rounded-pill d-inline">
                              <%=item.role%>
                            </span>
                          </td>
                          <td>
                            <button type="submit" data-toggle="modal" data-target="#userDeleteModal"
                              data-id="<%=item.id %>" class="btn btn-sm btn-danger"><i class="fa fa-times"></i></button>
                          </td>
                        </tr>

                        <% })} %>

                    </tbody>
                  </table>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal User Delete -->

      <div class="modal fade" id="userDeleteModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Atencion</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              ¿Esta seguro que desea borrar el usuario?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Volver</button>
              <form action="" method="POST"><button type="submit" class="btn btn-danger">Borrar</button></form>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal Crear Producto-->

      <div class="modal fade" id="productCreateModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Formulario de Creación de Productos</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">

              <form action="/ruta_para_insertar_producto" method="POST">
                
                <div class="mb-3">
                  <label for="category" class="form-label">Categoría</label>
                  <select class="form-control" id="category" name="category" required>
                    <option value="">Seleccionar categoría</option>
                    <% if (Categories) { Categories.forEach (item=> { %>
                    <option value="<%=item.id%>">
                      <%=item.name%>
                    </option>
                    <% })} %>
                    <option value="otra">Otra categoría</option>
                  </select>
                </div>

                <!-- Campo adicional para ingresar el nombre de la nueva categoría -->
                <div class="mb-3 d-none" id="divNuevaCategoria">
                  <label for="nuevaCategoria" class="form-label">Nueva categoría</label>
                  <input type="text" class="form-control" id="nuevaCategoria" name="nuevaCategoria">
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="code" class="form-label">Código</label>
                    <input type="text" class="form-control" id="code" name="code" required>
                  </div>
                  <div class="col-md-6">
                    <label for="name" class="form-label">Nombre</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="code" class="form-label">Marca</label>
                    <input type="text" class="form-control" id="code" name="code" required>
                  </div>
                  <div class="col-md-6">
                    <label for="name" class="form-label">Modelo</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                  </div>
                </div>               
              
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="code" class="form-label">Precio</label>
                    <input type="number" class="form-control" id="code" name="code" required>
                  </div>
                  <div class="col-md-6">
                    <label for="name" class="form-label">Stock</label>
                    <input type="number" class="form-control" id="name" name="name" required>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col">
                    <div class="form-check form-check-inline">
                      <input type="checkbox" class="form-check-input" id="is_featured" name="is_featured">
                      Destacado
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-check form-check-inline">
                      <input type="checkbox" class="form-check-input" id="is_offer" name="is_offer">
                      Oferta
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <label for="images" class="form-label">Imágenes</label>
                  <input type="file" class="form-control" id="images" name="images" multiple>
                </div>

                <div class="mb-3">
                  <label for="description" class="form-label">Descripción</label>
                  <textarea class="form-control" id="description" name="description" required></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary">Guardar Producto</button>

              </form>             

            </div>
          </div>
        </div>
      </div>

      <%-include("./partials/footer.ejs")%>

        <!-- script para mostrar u ocultar el campo de nueva categoría en el formulario -->

        <script>
          document.getElementById('category').addEventListener('change', function () {
            var divNuevaCategoria = document.getElementById('divNuevaCategoria');
            if (this.value === 'otra') {
              divNuevaCategoria.classList.remove('d-none');
            } else {
              divNuevaCategoria.classList.add('d-none');
            }
          });
        </script>

        <!-- script para obtener el user id de la lista de users al momento de eliminar -->

        <script>
          $(document).ready(function () {
            // Cuando se hace clic en un botón con la clase "btn-danger"
            $('#userDeleteModal').on('show.bs.modal', function (event) {
              // Capturamos el botón que activó el modal
              var button = $(event.relatedTarget);
              // Obtenemos el valor de data-id del botón
              var userId = button.data('id');

              // Pasamos el valor al formulario de eliminación dentro del modal
              var modal = $(this);
              modal.find('form').attr('action', '/settings/user/delete/' + userId + '?_method=DELETE');
            });
          });
        </script>

  </body>

</html>